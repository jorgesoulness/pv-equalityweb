var ToolsetDynamicSources=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=12)}([function(e,t){e.exports=lodash},function(e,t){e.exports=window.wp.hooks},function(e,t){e.exports=window.wp.data},function(e,t){e.exports=window.wp.element},function(e,t){e.exports=window.wp.i18n},function(e,t){e.exports=window.wp.components},function(e,t){e.exports=window.toolsetCommonEs.block.control},function(e,t){e.exports=window.wp.compose},function(e,t){e.exports=window.wp.apiFetch},function(e,t){e.exports=window.wp.url},function(e,t,r){},function(e,t,r){},function(e,t,r){"use strict";r.r(t);var n=r(2),o=r(1),c=r(4),i=r(8),s=r.n(i),a=r(0);function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,c=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,c=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw c}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function l(e,t,r,n,o,c,i){try{var s=e[c](i),a=s.value}catch(e){return void r(e)}s.done?t(a):Promise.resolve(a).then(n,o)}function p(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var c=e.apply(t,r);function i(e){l(c,n,o,i,s,"next",e)}function s(e){l(c,n,o,i,s,"throw",e)}i(void 0)})}}var d=window.toolsetDynamicSourcesScriptData,f=function(e,t,r,n){var o=d.cacheForViews&&d.cacheForViews[t]?d.cacheForViews[t]:d.cache,c="";return void 0!==o[r]&&(c=o[r]),void 0!==o[e]&&void 0!==o[e][r]&&t===o[e]["post-id"]&&(c=o[e][r]),void 0!==c[n]&&(c=c[n]),""!==c?{sourceContent:c}:null},b=function(){var e=p(regeneratorRuntime.mark(function e(t,r,o){var i,a,u,l,p,d=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=d.length>3&&void 0!==d[3]?d[3]:null,!(a=f(t,r,o,i))){e.next=4;break}return e.abrupt("return",a);case 4:return u="/toolset-dynamic-sources/v1/render-source/?source=".concat(o,"&provider=").concat(t,"&post=").concat(r),l="",i&&(l+="field=".concat(i)),""!==l&&(u+="&".concat(l)),e.prev=8,e.next=11,s()({path:u});case 11:return e.abrupt("return",e.sent);case 14:return e.prev=14,e.t0=e.catch(8),p=Object(c.sprintf)(Object(c.__)('Something went wrong while fetching the dynamic content from the selected source, with message: "%s".',"wpv-views"),e.t0.message),Object(n.dispatch)("core/notices").createErrorNotice(p,{id:"toolset_blocks_dynamic_source_content_preloading_error"}),e.abrupt("return",null);case 19:case"end":return e.stop()}},e,null,[[8,14]])}));return function(t,r,n){return e.apply(this,arguments)}}(),y=function(){var e=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s()({path:"/toolset-dynamic-sources/v1/get-cache?post=".concat(t)});case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",null);case 9:case"end":return e.stop()}},e,null,[[0,6]])}));return function(t){return e.apply(this,arguments)}}(),m=function(e){return new Promise(function(t){s()({path:"/toolset-dynamic-sources/v1/search-post?s=".concat(e)}).then(function(e){var r=e.map(function(e){return{label:e.title,value:"custom_post_type|".concat(e.post_type,"|").concat(e.id)}});t(r)})})},v=function(){var e=p(regeneratorRuntime.mark(function e(t){var r,n,c,i,l,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.value.split("|"),n=u(r,3),c=n[1],i=n[2],e.next=3,s()({path:"toolset-dynamic-sources/v1/get-source?post_type=".concat(c,"&post_id=").concat(i)});case 3:l=e.sent,f=t.value,d.postProviders.find(function(e){return e.value===f})||d.postProviders.push({value:f,label:t.label}),d.dynamicSources[f]=l.__current_post,y(i).then(function(e){d.cache[f]=e.__current_post,Object(o.doAction)("tb.caching.updated")}),Object(o.addAction)("tb.caching.tick","toolset-blocks",function(){var e=p(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(i);case 2:r=e.sent,t[f]&&Object(a.isEqual)(t[f],r.__current_post)||(d.cache[f]=r.__current_post,Object(o.doAction)("tb.caching.updated"));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();function h(e,t,r,n,o,c,i){try{var s=e[c](i),a=s.value}catch(e){return void r(e)}s.done?t(a):Promise.resolve(a).then(n,o)}var g=window.toolsetDynamicSourcesScriptData,O=function(){var e,t=(e=regeneratorRuntime.mark(function e(){var t,r,c,i,s,a,u,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Object(n.select)("core/editor"),r=JSON.stringify(t.getBlocks()),c=!!r.includes("dynamic"),i=!!r.includes("toolset-blocks/field"),s=!!r.includes("toolset-blocks/repeating-field"),a=!!r.includes("toolset-blocks/fields-and-text"),(c||a||i||s)&&!Object(n.select)(g.dynamicSourcesStore).getCacheUpdating()){e.next=8;break}return e.abrupt("return");case 8:return u=Object(n.select)(g.dynamicSourcesStore).getPreviewPost()||t.getCurrentPostId(),Object(n.dispatch)(g.dynamicSourcesStore).setCacheUpdating(!0),e.next=12,y(u);case 12:l=e.sent,Object(n.dispatch)(g.dynamicSourcesStore).setCacheUpdating(!1),Object(o.doAction)("tb.dynamicSources.actions.cache.tick",l);case 15:case"end":return e.stop()}},e)}),function(){var t=this,r=arguments;return new Promise(function(n,o){var c=e.apply(t,r);function i(e){h(c,n,o,i,s,"next",e)}function s(e){h(c,n,o,i,s,"throw",e)}i(void 0)})});return function(){return t.apply(this,arguments)}}(),S=function(){Object(o.addAction)("tb.dynamicSources.actions.cache.tick","toolset-blocks",function(e){var t=!1;e&&!Object(a.isEqual)(e,g.cache)&&(g.cache=Object.assign({},g.cache,e),t=!0),g.cacheForViews&&(t=!0),t&&Object(o.doAction)("tb.dynamicSources.actions.cache.updated")}),Object(o.addAction)("tb.dynamicSources.actions.cache.initiateFetching","toolset-blocks",function(){O()}),window.setInterval(function(){Object(o.doAction)("tb.dynamicSources.actions.cache.initiateFetching")},3e4)};function w(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var P=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,(r=[{key:"get",value:function(e,t){if(e&&t)return s()({path:"/toolset-dynamic-sources/v1/dynamic-sources?post-type=".concat(e.join(","),"&preview-post-id=").concat(t)})}}])&&w(t.prototype,r),n&&w(t,n),e}();function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(r,!0).forEach(function(t){C(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function C(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var E=window.toolsetDynamicSourcesScriptData,k={dynamicSources:[]},D={setLoading:function(e,t){return{type:"SET_LOADING",blockID:e,loading:t}},setCacheUpdating:function(e){return{type:"SET_CACHE_UPDATING",cacheUpdating:e}},setPreviewPost:function(e){return{type:"SET_PREVIEW_POST",previewPost:e}},setDynamicSources:function(e){return{type:"DYNAMIC_SOURCES_SET",dynamicSources:e}},getDynamicSources:function(e,t,r){return{type:"DYNAMIC_SOURCES_GET",postTypes:e,previewPostID:t}}},R=new P,F={DYNAMIC_SOURCES_GET:function(e){return R.get(e.postTypes,e.previewPostID)}},A={getDynamicSources:regeneratorRuntime.mark(function e(t,r,n){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.getDynamicSources(t,r,n);case 2:return o=e.sent,e.next=5,D.setDynamicSources(o);case 5:case"end":return e.stop()}},e)})},I={actions:D,selectors:{getLoading:function(e,t){return!!e[t]&&e[t].loading},getCacheUpdating:function(e){return!!e.cacheUpdating&&e.cacheUpdating},getPreviewPost:function(e){return e.previewPost?e.previewPost:null},getDynamicSources:function(e,t,r,n){return e.dynamicSources}},controls:F,resolvers:A,reducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_LOADING":return _({},e,C({},t.blockID,{loading:t.loading}));case"SET_CACHE_UPDATING":return _({},e,{cacheUpdating:!!t.cacheUpdating});case"SET_PREVIEW_POST":return _({},e,{previewPost:parseInt(t.previewPost)});case"DYNAMIC_SOURCES_SET":return _({},e,{dynamicSources:t.dynamicSources})}return e}},T=function(){Object(n.registerStore)(E.dynamicSourcesStore,I)},x=r(3),U=r(5),V=r(7),L=r(9),N=r(6);r(10);function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(r,!0).forEach(function(t){H(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function q(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function W(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function H(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var $=window.toolsetDynamicSourcesScriptData,Y=function(e){function t(e){var r,n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,o=G(t).call(this,e),r=!o||"object"!==B(o)&&"function"!=typeof o?W(n):o,H(W(r),"updateBlockContentFromCache",function(){r.setState({postUrl:$.cache.__current_post["post-url"],postId:$.cache.__current_post["post-id"]})}),H(W(r),"maybeRenderUpdatingCacheSpinner",function(){var e=null;return r.props.isCacheUpdating&&(e=React.createElement("div",{className:"spinner-control"},React.createElement(U.Spinner,null))),e}),H(W(r),"makePreviewUrl",function(){var e=r.state.postUrl;return r.state.postId!==r.state.selectedPost.value&&(e=r.state.selectedPost.guid),Object(L.addQueryArgs)(e,{"content-template-id":r.props.currentPostId})}),H(W(r),"maybeRenderPreviewLink",function(){return React.createElement("span",{className:"editor-post-view"},React.createElement("a",{target:"wp-preview-"+r.props.currentPostId,rel:"noopener noreferrer",href:r.makePreviewUrl()},Object(c.__)("View on front-end","wpv-views")),!!r.props.hasChangedContent&&React.createElement("small",null,Object(c.__)("(Click Update button first to view the recent changes)","wpv-views")))}),r.state={selectedPost:Object(a.find)($.previewPosts,["value",parseInt(r.props.previewPost)]),postUrl:$.cache.__current_post["post-url"],postId:$.cache.__current_post["post-id"]},r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(t,x["Component"]),r=t,(n=[{key:"componentDidMount",value:function(){Object(o.addAction)("tb.dynamicSources.actions.cache.updated","toolset-blocks",this.updateBlockContentFromCache)}},{key:"render",value:function(){var e=this;if(!$.previewPosts||$.previewPosts.length<1)return null;var t=Object(a.maxBy)($.previewPosts,function(e){return e.label.length}),r=$.previewPosts&&$.previewPosts.length>0?5*t.label.length+120:0,n={container:function(e){return K({},e,{width:"180px"})},menu:function(e){return K({},e,{width:"".concat(r,"px")})}};return React.createElement(x.Fragment,null,React.createElement("label",{htmlFor:"post-selector-".concat(this.props.instanceId)},Object(c.__)("View with","wpv-views"),": "),React.createElement(N.Select,{id:"post-selector-".concat(this.props.instanceId),value:this.state.selectedPost,options:$.previewPosts,onChange:function(t){e.setState({selectedPost:t}),e.props.setPreviewPost(t.value),e.props.editPost({meta:{tb_preview_post:t.value}})},className:"toolset-blocks-post-selector-control",styles:n}),this.maybeRenderPreviewLink(),this.maybeRenderUpdatingCacheSpinner())}}])&&q(r.prototype,n),i&&q(r,i),t}(),J=Object(V.compose)([Object(n.withSelect)(function(e){var t=e($.dynamicSourcesStore),r=t.getPreviewPost,n=t.getCacheUpdating,o=e("core/editor"),c=o.getCurrentPostId,i=o.hasChangedContent;return{previewPost:r(),isCacheUpdating:n(),currentPostId:c(),hasChangedContent:i()}}),Object(n.withDispatch)(function(e){var t=e("core/editor").editPost;return{setPreviewPost:e($.dynamicSourcesStore).setPreviewPost,editPost:t}}),V.withInstanceId])(Y);function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function X(e){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e,t){return(ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function te(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var re=window.toolsetDynamicSourcesScriptData,ne=function(e){function t(){var e,r,o,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=X(t).call(this,c),e=!o||"object"!==z(o)&&"function"!=typeof o?Z(r):o,te(Z(e),"PLACEHOLDER_ID","toolset-blocks-post-selector"),te(Z(e),"deferAddingPostSelector",function(t){var r=Object(n.select)("core/editor").getCurrentPostType;if(0!==jQuery("body").length){var o=jQuery("#editor.block-editor__container");if(0!==o.length)0!==o.find(".edit-post-header-toolbar").length?Object(a.isEqual)("view-template",r())&&e.addPostSelector():setTimeout(Object(a.partial)(t,t),1)}else setTimeout(Object(a.partial)(t,t),1)}),te(Z(e),"addPostSelector",function(){var t=jQuery("#editor.block-editor__container .edit-post-header-toolbar");0!==t.length&&(t.append('<div id="'.concat(e.PLACEHOLDER_ID,'"></div>')),Object(x.render)(React.createElement(J,null),document.querySelector("#"+e.PLACEHOLDER_ID)))}),!Object(n.select)(re.dynamicSourcesStore).getPreviewPost()){var i=Object(a.find)(re.previewPosts,["value",parseInt(re.postPreview)]);i&&Object(a.has)(i,"value")&&Object(n.dispatch)(re.dynamicSourcesStore).setPreviewPost(Object(a.get)(i,"value"))}return e.deferAddingPostSelector(e.deferAddingPostSelector),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ee(e,t)}(t,x["Component"]),t}();function oe(e){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ce(r,!0).forEach(function(t){pe(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ce(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function se(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ae(e){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ue(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function le(e,t){return(le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var de=window,fe=de.toolsetDynamicSourcesScriptData,be=de.Toolset,ye=function(e){function t(){var e,r,c,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,c=ae(t).call(this,i),e=!c||"object"!==oe(c)&&"function"!=typeof c?ue(r):c,pe(ue(e),"postTypes",[]),pe(ue(e),"previewPostId",null),pe(ue(e),"viewStoreIds",[]),pe(ue(e),"random",null),pe(ue(e),"blockInsideViewAdjustmentCallback",function(t,r,o){var c=e.maybeGetParentViewBlock(r);if(c){var i=Object(n.select)(c.attributes.reduxStoreId).getGeneral().preview_post_id;if(fe["".concat(o,"ForViews")]&&fe["".concat(o,"ForViews")][i])return fe["".concat(o,"ForViews")][i]}return t}),pe(ue(e),"maybeGetParentViewBlock",function(e){var t=Object(n.select)("core/editor"),r=t.getBlock,o=t.getBlockRootClientId,c=null,i=e;do{if(i=o(i)){var s=r(i);Object(a.includes)(["toolset-views/view-editor","toolset-views/wpa-editor"],s.name)&&(c=s)}}while(i);return c}),Object(o.addAction)("tb.dynamicSources.actions.cache.initiateFetching","toolset-blocks",function(){Object(n.select)("core/editor").getBlocks().filter(function(e){return"toolset-views/view-editor"===e.name}).forEach(function(e){var t=e.attributes.reduxStoreId,r=Object(n.select)(t).getGeneral(),c=Object(n.select)(t).getContentSelection();"posts"===c.query_type&&Object(o.doAction)("tb.dynamicSources.action.updateSources",c.post_type,r.preview_post_id,t)})}),Object(o.addFilter)("tb.dynamicSources.filters.adjustPreviewPostID","toolset-blocks",function(t,r){var o=e.maybeGetParentViewBlock(r);return o?Object(n.select)(o.attributes.reduxStoreId).getGeneral().preview_post_id:t}),Object(o.addFilter)("tb.dynamicSources.filters.adjustSourcesForBlocksInsideViews","toolset-blocks",function(t,r){return e.blockInsideViewAdjustmentCallback(t,r,"dynamicSources")}),Object(o.addFilter)("tb.dynamicSources.filters.adjustProvidersForBlocksInsideViews","toolset-blocks",function(t,r){return e.blockInsideViewAdjustmentCallback(t,r,"postProviders")}),Object(o.addAction)("tb.dynamicSources.action.updateSources","toolset-blocks",function(t,r,o){e.postTypes=t,e.random=Math.random(),e.previewPostId=r,e.viewStoreIds[r]&&!e.viewStoreIds[r].includes(o)?e.viewStoreIds[r]=[].concat(se(e.viewStoreIds[r]),[o]):e.viewStoreIds[r]=[o],Object(n.select)(fe.dynamicSourcesStore).getDynamicSources(e.postTypes,e.previewPostId,e.random)}),be.hooks.addFilter("wpv-filter-wpv-shortcodes-gui-post-id-for-dialog-create",function(t){return e.previewPostId||t}),Object(n.subscribe)(function(){if(!(e.postTypes.length<=0)){var t=Object(n.select)(fe.dynamicSourcesStore).getDynamicSources(e.postTypes,e.previewPostId,e.random);if(t&&t.previewPostId){var r={},c={},i={};c[t.previewPostId]=t.postProviders,r[t.previewPostId]=t.dynamicSources,i[t.previewPostId]=t.cache,fe.postProvidersForViews=ie({},fe.postProvidersForViews,{},c),fe.dynamicSourcesForViews=ie({},fe.dynamicSourcesForViews,{},r);var s=!1,a=ie({},fe.cacheForViews,{},i);JSON.stringify(a)!==JSON.stringify(fe.cacheForViews)&&(s=!0,fe.cacheForViews=a,e.viewStoreIds[t.previewPostId].forEach(function(e){Object(o.doAction)("toolset.views.updatePreview",e)})),e.previewPostId!==t.previewPostId&&(s=!0),s&&Object(o.doAction)("tb.dynamicSources.actions.cache.tick")}}}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&le(e,t)}(t,x["Component"]),t}(),me=function(e){switch(e.constructor){case Array:return e.length?e[0]:"";case Object:var t=Object.keys(e);return t.length?e[t[0]]:"";default:return e.toString()}};function ve(e){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ge(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Se(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var we=window.toolsetDynamicSourcesScriptData,Pe=function(e){function t(){var e,r,c,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var s=arguments.length,a=new Array(s),u=0;u<s;u++)a[u]=arguments[u];return c=this,i=(e=he(t)).call.apply(e,[this].concat(a)),r=!i||"object"!==ve(i)&&"function"!=typeof i?ge(c):i,Se(ge(r),"componentDidUpdate",function(e){r.props.previewPost!==e.previewPost&&(Object(n.select)(we.dynamicSourcesStore).getCacheUpdating()||Object(o.doAction)("tb.dynamicSources.actions.cache.initiateFetching"))}),Se(ge(r),"render",function(){return null}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(t,x["Component"]),t}(),je=Object(V.compose)([Object(n.withSelect)(function(e){return{previewPost:(0,e(we.dynamicSourcesStore).getPreviewPost)()}})])(Pe);function _e(e){return(_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(){return(Ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Ee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ke(e,t){return!t||"object"!==_e(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function De(e){return(De=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Re(e,t){return(Re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Fe=Object(V.createHigherOrderComponent)(function(e){var t=function(t){function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),ke(this,De(r).apply(this,arguments))}var n,o,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Re(e,t)}(r,x["Component"]),n=r,(o=[{key:"render",value:function(){return React.createElement(x.Fragment,null,React.createElement(je,Ce({},this.props.ownProps,this.mergeProps)),React.createElement(e,Ce({},this.props.ownProps,this.mergeProps)))}}])&&Ee(n.prototype,o),c&&Ee(n,c),r}();return function(e){return React.createElement(t,{ownProps:e})}},"withPostPreview");function Ae(e){return(Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Te(e,t){return!t||"object"!==Ae(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xe(e){return(xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ue(e,t){return(Ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ve="tb-dynamic-container",Le=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Te(this,xe(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ue(e,t)}(t,x["Component"]),r=t,(n=[{key:"filterUnusedDynamics",value:function(e){Array.isArray(e)||(e=[e]);var t=[];return e.map(function(e){e.source&&e.provider&&t.push(e)}),t}},{key:"getShortcodeStart",value:function(e){if(0===e.length)return"";var t="[".concat(Ve),r=[],n=[],o=[];return e.map(function(e){e.customPost?r.push(e.customPost.value):r.push(e.provider),n.push(e.source),o.push(e.field?e.field:"")}),t+=" provider='".concat(r.join("#+*#"),"'"),t+=" source='".concat(n.join("#+*#"),"'"),t+=" field='".concat(o.join("#+*#"),"'"),t+="]"}},{key:"getShortcodeEnd",value:function(e){return 0===e.length?"":"[/".concat(Ve,"]")}},{key:"render",value:function(){var e=this.props,t=e.children,r=e.requiredDynamics,n=this.filterUnusedDynamics(r);return React.createElement(x.Fragment,null,this.getShortcodeStart(n),t,this.getShortcodeEnd(n))}}])&&Ie(r.prototype,n),o&&Ie(r,o),t}();r(11);function Ne(e){return(Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Me(e,t){return!t||"object"!==Ne(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ke(e){return(Ke=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qe(e,t){return(qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ge=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Me(this,Ke(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qe(e,t)}(t,x["Component"]),r=t,(n=[{key:"render",value:function(){return React.createElement(x.Fragment,null,Object(c.__)("This content is coming from a Dynamic Source. Use the Settings Sidebar to change its source.","wpv-views"))}}])&&Be(r.prototype,n),o&&Be(r,o),t}();function We(e){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function He(e){return(He=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ye(e,t){return(Ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Je(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ze=window.toolsetDynamicSourcesScriptData,Xe=function(e){function t(){var e,r,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return n=this,o=(e=He(t)).call.apply(e,[this].concat(s)),r=!o||"object"!==We(o)&&"function"!=typeof o?$e(n):o,Je($e(r),"maybeRenderLoadingSpinner",function(){var e=null;return r.props.loading&&(e=React.createElement(U.Spinner,{key:"tb-spinner"})),e}),Je($e(r),"renderOverlayWithSpiner",function(){return React.createElement("div",{className:"tb-overlay wp-block-embed is-loading",key:"tb-overlay"},React.createElement(U.Spinner,null))}),Je($e(r),"renderEditWrapperContent",function(){var e=[r.props.children];return r.props.loading&&e.push(r.renderOverlayWithSpiner()),React.createElement(x.Fragment,null,e)}),Je($e(r),"renderDynamicContentBreadcrumb",function(){var e=r.props,t=e.isSelected,n=e.hasDynamicSource;if(t&&n)return React.createElement("div",{className:"editor-block-list__breadcrumb block-editor-block-list__breadcrumb"},React.createElement(U.Toolbar,null,React.createElement(x.Fragment,null,r.maybeRenderLoadingSpinner(),React.createElement("span",{className:"breadcrumb-label"},Object(c.__)("Dynamic Content","wpv-views")))))}),Je($e(r),"renderEditWrapper",function(){var e=r.props.hasDynamicSource,t="wp-block-toolset-blocks-wrapper";return React.createElement("div",{className:e?"".concat(t," dynamic"):t},r.renderEditWrapperContent())}),r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ye(e,t)}(t,x["Component"]),r=t,(n=[{key:"render",value:function(){var e=this.props,t=e.hasDynamicSource,r=e.disableTooltip,n=void 0!==r&&r,o=this.renderEditWrapper();return t&&!n&&(o=React.createElement(N.Tooltip,{text:React.createElement(Ge,null),trigger:"mouseenter focus click",maxWidth:"500"},o)),o}}])&&Qe(r.prototype,n),o&&Qe(r,o),t}(),Ze=Object(V.compose)([Object(n.withSelect)(function(e,t){return{loading:(0,e(ze.dynamicSourcesStore).getLoading)(t.clientId)}})])(Xe);function et(e){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function rt(e,t){return!t||"object"!==et(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function nt(e){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ot(e,t){return(ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ct=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),rt(this,nt(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}(t,x["Component"]),r=t,(n=[{key:"render",value:function(){var e=this.props,t=e.hasDynamicSource,r=e.children;if(!t)return null;var n=React.createElement("div",{className:"tb-field__overlay"});return r&&(n=React.createElement("div",{className:"tb-field__overlay"},r)),React.createElement(N.Tooltip,{text:React.createElement(Ge,null),trigger:"mouseenter focus click",maxWidth:"500"},n)}}])&&tt(r.prototype,n),o&&tt(r,o),t}();function it(e){return(it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function st(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,c=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,c=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw c}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function at(e,t,r,n,o,c,i){try{var s=e[c](i),a=s.value}catch(e){return void r(e)}s.done?t(a):Promise.resolve(a).then(n,o)}function ut(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var c=e.apply(t,r);function i(e){at(c,n,o,i,s,"next",e)}function s(e){at(c,n,o,i,s,"throw",e)}i(void 0)})}}function lt(){return(lt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function pt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function dt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pt(r,!0).forEach(function(t){vt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pt(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function ft(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function bt(e){return(bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mt(e,t){return(mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function vt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ht=window.toolsetDynamicSourcesScriptData,gt=function(e){function t(e){var r,n,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,i=bt(t).call(this,e),r=!i||"object"!==it(i)&&"function"!=typeof i?yt(n):i,vt(yt(r),"DEFAULT_POST_PROVIDER",null),vt(yt(r),"ungroupedSources",[]),vt(yt(r),"componentDidUpdate",function(e){if(r.props.previewPost!==e.previewPost&&r.ungroupedSources.length&&r.props.dynamicSourcesEligibleAttribute.sourceObject){var t=Object(a.find)(r.ungroupedSources,{value:r.props.dynamicSourcesEligibleAttribute.sourceObject}),n=t.fields.length>0?Object(a.find)(t.fields,{value:r.props.dynamicSourcesEligibleAttribute.fieldObject}):null;r.dynamicSourceSelectChanged(t),r.dynamicSourceFieldSelectChanged(n)}}),vt(yt(r),"customStyles",{menu:function(e){return dt({},e,{position:"relative"})},input:function(e,t){return dt({},e,{"& input:focus":{boxShadow:(t.isFocused,"none !important")}})}}),vt(yt(r),"filterSources",function(){var e=r.props,t=e.dynamicSourcesEligibleAttribute,n=e.postType,c=e.clientId,i=e.componentId,s="__custom_post"===t.postProviderObject&&t.customPostObject?t.customPostObject.value:t.postProviderObject||r.DEFAULT_POST_PROVIDER,u=Object(o.applyFilters)("tb.dynamicSources.filters.adjustSourcesForBlocksInsideViews",ht.dynamicSources,c),l=i?Object(o.applyFilters)("tb.dynamicSources.filters.adjustSourcesForBlocks",u,i):u,p=Object(a.cloneDeep)(l[s]);return p.forEach(function(e){e.options=e.options.filter(function(e){var c=function(e,t){if(!t)return!0;var r=Array.isArray(t)?t:[t];return!e.filter(function(e){return r.includes(e)}).length},i=Object(o.applyFilters)("toolsetViews.filters.getParentViewBlock",null,r.props.clientId),s=Object(o.applyFilters)("toolsetViews.filters.getViewEditorBlockTypes",null);if("post-content"===e.value&&"view-template"!==n&&!Object(a.isUndefined)(s.BLOCK_ID_EDITOR)&&s.BLOCK_ID_EDITOR!==Object(a.get)(i,"name",null))return!1;if(r.ungroupedSources.push(e),Object(a.has)(e,"fields")&&!Object(a.isEmpty)(e.fields)){var u=Object(a.find)(e.fields,function(e){return!!c(e.categories,t.bannedCategories)&&Object(a.includes)(e.categories,t.category)});return!Object(a.isEmpty)(u)}return!!c(e.categories,t.bannedCategories)&&Object(a.includes)(e.categories,t.category)})}),p}),vt(yt(r),"renderDynamicPostProviderSelect",function(){var e=r.props,t=e.dynamicSourcesEligibleAttribute,n=e.clientId,i=e.hideLabels;t.postProviderObject||t.selectPostProviderChangedCallback(r.DEFAULT_POST_PROVIDER);var s=Object(o.applyFilters)("tb.dynamicSources.filters.adjustProvidersForBlocksInsideViews",ht.postProviders,n),u=Object(a.find)(s,{value:t.postProviderObject}),l=i?{placeholder:Object(c.__)("Select a Post Source","wpv-views")}:{};return React.createElement(x.Fragment,{key:"post-provider-select"},React.createElement(U.BaseControl,{label:!i&&Object(c.__)("Post Source","wpv-views")},React.createElement(N.Select,lt({options:s,styles:r.customStyles},l,{value:u,onChange:function(e){t.selectPostProviderChangedCallback(e.value),t.selectCustomPostChangedCallback(null),t.selectSourceChangedCallback(null),t.selectFieldChangedCallback(null),t.sourceContentFetchedCallback("")}}))))}),vt(yt(r),"dynamicSourceSelectChanged",function(){var e=ut(regeneratorRuntime.mark(function e(t){var n,c,i,s,a,u,l,p,d,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(o.doAction)("tb.dynamicSources.actions.source.changed",t),n=r.props.dynamicSourcesEligibleAttribute,c=null!==t?t.value:null,n.selectSourceChangedCallback(c),n.selectFieldChangedCallback(null),!t||0!==t.fields.length){e.next=15;break}return i=r.props,s=i.clientId,a=i.setLoading,u=i.post,l=i.previewPost,p=n.postProviderObject||r.DEFAULT_POST_PROVIDER,a(s,!0),d=Object(o.applyFilters)("tb.dynamicSources.filters.adjustPreviewPostID",l||u,s),e.next=12,r.fetchDynamicContent(p,d,c);case 12:null===(f=e.sent)?n.sourceContentFetchedCallback(""):n.sourceContentFetchedCallback(f),a(s,!1);case 15:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),vt(yt(r),"renderDynamicSourceSelect",function(){var e=r.props,t=e.dynamicSourcesEligibleAttribute,n=e.hideLabels,o=r.filterSources(),i=Object(a.find)(r.ungroupedSources,{value:t.sourceObject})||null;if("__custom_post"===t.postProviderObject&&!t.customPostObject)return null;var s=n?{placeholder:Object(c.__)("Select a Source","wpv-views")}:{};return React.createElement(x.Fragment,{key:"dynamic-source-select"},React.createElement(U.BaseControl,{label:!n&&Object(c.__)("Source","wpv-views")},React.createElement(N.Select,lt({isClearable:!0,options:o,styles:r.customStyles},s,{value:i,onChange:r.dynamicSourceSelectChanged}))))}),vt(yt(r),"dynamicSourceFieldSelectChanged",function(){var e=ut(regeneratorRuntime.mark(function e(t){var n,c,i,s,a,u,l,p,d,f,b;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(o.doAction)("tb.dynamicSources.actions.field.changed",t),n=r.props.dynamicSourcesEligibleAttribute,c=null!==t?t.value:null,n.selectFieldChangedCallback(c),!c){e.next=16;break}return i=r.props,s=i.clientId,a=i.setLoading,u=i.post,l=i.previewPost,a(s,!0),p=n.postProviderObject,d=n.sourceObject,n.sourceContentFetchedCallback(""),f=Object(o.applyFilters)("tb.dynamicSources.filters.adjustPreviewPostID",l||u,s),e.next=13,r.fetchDynamicContent(p,f,d,c);case 13:b=e.sent,n.sourceContentFetchedCallback(b),a(s,!1);case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),vt(yt(r),"renderDynamicSourceSearchPost",function(){var e=r.props,t=e.dynamicSourcesEligibleAttribute,n=e.hideLabels;if("__custom_post"!==t.postProviderObject)return null;var o=n?{placeholder:Object(c.__)("Select a Post Name","wpv-views")}:{};return React.createElement(x.Fragment,{key:"dynamic-custom-post-select"},React.createElement(U.BaseControl,{label:!n&&Object(c.__)("Post Name","wpv-views")},React.createElement(N.AsyncSelect,lt({cacheOptions:!0,loadOptions:m.bind(yt(r)),onChange:r.customPostSelectChanged,styles:r.customStyles},o,{value:t.customPostObject}))))}),vt(yt(r),"customPostSelectChanged",function(){var e=ut(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.props.dynamicSourcesEligibleAttribute,e.next=3,r.loadSourceFromCustomPost(t);case 3:n.selectCustomPostChangedCallback(t),n.selectSourceChangedCallback(null),n.selectFieldChangedCallback(null),n.sourceContentFetchedCallback("");case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),vt(yt(r),"renderDynamicSourceFieldsSelect",function(){var e=r.props,t=e.dynamicSourcesEligibleAttribute,n=e.hideLabels;if(t.sourceObject){var o=Object(a.find)(r.ungroupedSources,["value",t.sourceObject]),i=o?o.fields:[];if(i=Object(a.filter)(i,function(e){return Object(a.includes)(e.categories,t.category)}),Object(a.isEmpty)(i))return;var s=1===Object.keys(i).length?i:null,u=["image","video","audio"].includes(t.category)?Object(a.find)(i,{value:t.fieldObject}):Object(a.find)(i,{value:t.fieldObject})||s;u&&u===s&&r.dynamicSourceFieldSelectChanged(u[0]);var l=n?{placeholder:Object(c.__)("Select a Field","wpv-views")}:{};return React.createElement(U.BaseControl,{label:!n&&Object(c.__)("Field","wpv-views"),key:"dynamic-source-fields-select"},React.createElement(N.Select,lt({isClearable:!0,options:i,styles:r.customStyles},l,{value:u,onChange:r.dynamicSourceFieldSelectChanged})))}}),vt(yt(r),"renderDynamicSourcesInfoMessages",function(){return Object.keys(r.state.infoMessageQueue).length<=0?null:Object.keys(r.state.infoMessageQueue).map(function(e){return React.createElement(U.Notice,{status:"info",key:e,isDismissible:!1},r.state.infoMessageQueue[e])})}),vt(yt(r),"renderDynamicSourceSelectControls",function(){if(r.props.dynamicSourcesEligibleAttribute.condition)return[r.renderDynamicPostProviderSelect(),r.renderDynamicSourceSearchPost(),r.renderDynamicSourceSelect(),r.renderDynamicSourceFieldsSelect()]}),vt(yt(r),"renderDynamicSourceToggleControl",function(){var e=r.props.dynamicSourcesEligibleAttribute;return e.toggleHide||!1?null:React.createElement(U.ToggleControl,{label:e.label,checked:e.condition,onChange:e.toggleChangedCallback})}),vt(yt(r),"renderDynamicSourceControls",function(){var e=r.props,t=e.clientId,n=e.dynamicSourcesEligibleAttribute,o=n.attributeKey?"-"+n.attributeKey:"";if(n)return React.createElement("div",{className:t+o},r.renderDynamicSourceToggleControl(),r.renderDynamicSourceSelectControls(),r.renderDynamicSourcesInfoMessages())}),r.DEFAULT_POST_PROVIDER=ht.postProviders[0].value,r.state={infoMessageQueue:{}},Object(o.addAction)("tb.dynamicSources.actions.field.changed","toolset-blocks",function(e){var t=r.state.infoMessageQueue;e&&"rfg"===e.type?t.rfg=React.createElement(x.Fragment,null,React.createElement("p",{dangerouslySetInnerHTML:{__html:Object(c.sprintf)(Object(c.__)("%1$s is a Repeating Field Group. If you want to display its fields here, put another View block into this Loop item and choose %1$s in the Content Selection step of the View wizard.","wpv-views"),"<strong>".concat(e.label,"</strong>"))}})):delete t.rfg,r.setState({infoMessageQueue:t})}),Object(o.addAction)("tb.dynamicSources.actions.dynamicSourceComponentDidMount","toolset-blocks",function(e){if(e===r.props.clientId){var t=r.props.dynamicSourcesEligibleAttribute,n=Object(a.find)(r.ungroupedSources,{value:t.sourceObject})||null;if(n){Object(o.doAction)("tb.dynamicSources.actions.source.changed",n);var c=n.fields.length>0?Object(a.find)(n.fields,{value:t.fieldObject}):null;c&&Object(o.doAction)("tb.dynamicSources.actions.field.changed",c)}}}),r}var r,n,i,s,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mt(e,t)}(t,x["Component"]),r=t,(n=[{key:"componentDidMount",value:function(){Object(o.doAction)("tb.dynamicSources.actions.dynamicSourceComponentDidMount",this.props.clientId)}},{key:"componentWillMount",value:(u=ut(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.props.dynamicSourcesEligibleAttribute).customPostObject||ht.dynamicSources[t.customPostObject.value]){e.next=4;break}return e.next=4,this.loadSourceFromCustomPost(t.customPostObject);case 4:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"loadSourceFromCustomPost",value:(s=ut(regeneratorRuntime.mark(function e(t){var r,n,o,c,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props,n=r.clientId,o=r.dynamicSourcesEligibleAttribute,(c=r.setLoading)(n,!0),e.next=4,v(t);case 4:i=t.value,o.postProviderObject=i,c(n,!1);case 7:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"isCustomPostProvider",value:function(e){return e.match(/^custom_post_type\|[^\|]+\|\d+$/)||"__custom_post"===e}},{key:"fetchDynamicContent",value:function(e,t,r,n){var o=this.props.dynamicSourcesEligibleAttribute;if(!o.customPostObject)return b(e,t,r,n);var c=this.isCustomPostProvider(e),i=st((c?o.customPostObject.value:"").split("|"),2)[1],s=c?i:t,a=c?o.customPostObject.value:e;return b(a,s,r,n)}},{key:"render",value:function(){return this.renderDynamicSourceControls()}}])&&ft(r.prototype,n),i&&ft(r,i),t}(),Ot=Object(V.compose)([Object(n.withSelect)(function(e){var t=e("core/editor"),r=t.getCurrentPostId,n=t.getCurrentPostType,o=e(ht.dynamicSourcesStore).getPreviewPost;return{post:r(),postType:n(),previewPost:o()}}),Object(n.withDispatch)(function(e){var t=e("core/notices").createErrorNotice,r=e(ht.dynamicSourcesStore);return{createErrorNotice:t,setLoading:r.setLoading,setPreviewPost:r.setPreviewPost}})])(gt);function St(e){return(St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,c=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,c=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw c}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Pt(e,t,r,n,o,c,i){try{var s=e[c](i),a=s.value}catch(e){return void r(e)}s.done?t(a):Promise.resolve(a).then(n,o)}function jt(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var c=e.apply(t,r);function i(e){Pt(c,n,o,i,s,"next",e)}function s(e){Pt(c,n,o,i,s,"throw",e)}i(void 0)})}}function _t(){return(_t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Ct(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Et(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ct(r,!0).forEach(function(t){At(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ct(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function kt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Dt(e){return(Dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Rt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ft(e,t){return(Ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function At(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var It=window.toolsetDynamicSourcesScriptData,Tt=function(e){function t(e){var r,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,i=Dt(t).call(this,e),r=!i||"object"!==St(i)&&"function"!=typeof i?Rt(n):i,At(Rt(r),"DEFAULT_POST_PROVIDER",null),At(Rt(r),"ungroupedSources",[]),At(Rt(r),"componentDidUpdate",function(e,t){if(r.props.previewPost!==e.previewPost&&r.ungroupedSources.length&&r.props.dynamicSourcesEligibleAttribute.sourceObject){var n=Object(a.find)(r.ungroupedSources,{value:r.props.dynamicSourcesEligibleAttribute.sourceObject}),o=n.fields.length>0?Object(a.find)(n.fields,{value:r.props.dynamicSourcesEligibleAttribute.fieldObject}):null;r.dynamicSourceSelectChanged(n),r.dynamicSourceFieldSelectChanged(o)}t.postProvider===r.state.postProvider&&t.source===r.state.source&&t.field===r.state.field||(r.state.customPost&&!It.dynamicSources[r.state.customPost.value]&&r.loadSourceFromCustomPost(r.state.customPost),r.state.postProvider&&r.state.source&&r.state.field?(r.props.dynamicSourcesEligibleAttribute.fieldSelectedCallback({postProvider:r.state.postProvider,source:r.state.source,field:r.state.field,customPost:r.state.customPost}),r.setState({fieldWasSelected:!0})):r.state.postProvider&&r.state.source&&!r.state.source.includes("|")?(r.props.dynamicSourcesEligibleAttribute.fieldSelectedCallback({postProvider:r.state.postProvider,source:r.state.source,field:null,customPost:r.state.customPost}),r.setState({fieldWasSelected:!0})):r.state.fieldWasSelected&&(r.props.dynamicSourcesEligibleAttribute.fieldSelectedCallback(null),r.setState({fieldWasSelected:!1})))}),At(Rt(r),"customStyles",{menu:function(e){return Et({},e,{position:"relative"})},input:function(e,t){return Et({},e,{"& input:focus":{boxShadow:(t.isFocused,"none !important")}})}}),At(Rt(r),"filterSources",function(){var e=r.props,t=e.dynamicSourcesEligibleAttribute,n=e.postType,c=e.clientId,i=e.componentId,s="__custom_post"===r.state.postProvider&&r.state.customPost?r.state.customPost.value:r.state.postProvider||r.DEFAULT_POST_PROVIDER,u=Object(o.applyFilters)("tb.dynamicSources.filters.adjustSourcesForBlocksInsideViews",It.dynamicSources,c),l=i?Object(o.applyFilters)("tb.dynamicSources.filters.adjustSourcesForBlocks",u,i):u,p=Object(a.cloneDeep)(l[s]);return p?(p.forEach(function(e){e.options=e.options.filter(function(e){var c=function(e,t){if(!t)return!0;var r=Array.isArray(t)?t:[t];return!e.filter(function(e){return r.includes(e)}).length},i=Object(o.applyFilters)("toolsetViews.filters.getParentViewBlock",null,r.props.clientId),s=Object(o.applyFilters)("toolsetViews.filters.getViewEditorBlockTypes",null);if("post-content"===e.value&&"view-template"!==n&&!Object(a.isUndefined)(s.BLOCK_ID_EDITOR)&&s.BLOCK_ID_EDITOR!==Object(a.get)(i,"name",null))return!1;if(r.ungroupedSources.push(e),Object(a.has)(e,"fields")&&!Object(a.isEmpty)(e.fields)){var u=Object(a.find)(e.fields,function(e){return!!c(e.categories,t.bannedCategories)&&Object(a.includes)(e.categories,t.category)});return!Object(a.isEmpty)(u)}return!!c(e.categories,t.bannedCategories)&&Object(a.includes)(e.categories,t.category)})}),p):[]}),At(Rt(r),"renderDynamicPostProviderSelect",function(){var e=r.props,t=e.clientId,n=e.hideLabels;r.state.postProvider||r.setState({postProvider:r.DEFAULT_POST_PROVIDER});var i=Object(o.applyFilters)("tb.dynamicSources.filters.adjustProvidersForBlocksInsideViews",It.postProviders,t),s=Object(a.find)(i,{value:r.state.postProvider}),u=n?{placeholder:Object(c.__)("Select a Post Source","wpv-views")}:{};return React.createElement(x.Fragment,{key:"post-provider-select"},React.createElement(U.BaseControl,{label:!n&&Object(c.__)("Post Source","wpv-views")},React.createElement(N.Select,_t({options:i,styles:r.customStyles},u,{value:s,onChange:function(e){return r.setState({postProvider:e.value,customPost:null,source:null,field:null})}}))))}),At(Rt(r),"dynamicSourceSelectChanged",function(){var e=jt(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Object(o.doAction)("tb.dynamicSources.actions.source.changed",t),n=null!==t?t.value:null,r.setState({source:n,field:null});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),At(Rt(r),"renderDynamicSourceSelect",function(){var e=r.props.hideLabels,t=r.filterSources(),n=Object(a.find)(r.ungroupedSources,{value:r.state.source})||null;if("__custom_post"===r.state.postProvider&&!r.state.customPost)return null;var o=e?{placeholder:Object(c.__)("Select a Source","wpv-views")}:{};return React.createElement(x.Fragment,{key:"dynamic-source-select"},React.createElement(U.BaseControl,{label:!e&&Object(c.__)("Source","wpv-views")},React.createElement(N.Select,_t({isClearable:!0,options:t,styles:r.customStyles},o,{value:n,onChange:r.dynamicSourceSelectChanged}))))}),At(Rt(r),"dynamicSourceFieldSelectChanged",function(){var e=jt(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Object(o.doAction)("tb.dynamicSources.actions.field.changed",t),n=null!==t?t.value:null,r.setState({field:n});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),At(Rt(r),"renderDynamicSourceSearchPost",function(){var e=r.props.hideLabels;if("__custom_post"!==r.state.postProvider)return null;var t=e?{placeholder:Object(c.__)("Select a Post Name","wpv-views")}:{};return React.createElement(x.Fragment,{key:"dynamic-custom-post-select"},React.createElement(U.BaseControl,{label:!e&&Object(c.__)("Post Name","wpv-views")},React.createElement(N.AsyncSelect,_t({cacheOptions:!0,loadOptions:m.bind(Rt(r)),onChange:r.customPostSelectChanged,styles:r.customStyles},t,{value:r.state.customPost}))))}),At(Rt(r),"customPostSelectChanged",function(){var e=jt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.loadSourceFromCustomPost(t);case 2:r.setState({customPost:t,source:null,field:null});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),At(Rt(r),"renderDynamicSourceFieldsSelect",function(){var e=r.props,t=e.dynamicSourcesEligibleAttribute,n=e.hideLabels;if(r.state.source){var o=Object(a.find)(r.ungroupedSources,["value",r.state.source]),i=o?o.fields:[];if(i=Object(a.filter)(i,function(e){return Object(a.includes)(e.categories,t.category)}),Object(a.isEmpty)(i))return;var s=1===Object.keys(i).length?i:null,u=["image","video","audio"].includes(t.category)?Object(a.find)(i,{value:r.state.field}):Object(a.find)(i,{value:r.state.field})||s;u&&u===s&&r.dynamicSourceFieldSelectChanged(u[0]);var l=n?{placeholder:Object(c.__)("Select a Field","wpv-views")}:{};return React.createElement(U.BaseControl,{label:!n&&Object(c.__)("Field","wpv-views"),key:"dynamic-source-fields-select"},React.createElement(N.Select,_t({isClearable:!0,options:i,styles:r.customStyles},l,{value:u,onChange:r.dynamicSourceFieldSelectChanged})))}}),At(Rt(r),"renderDynamicSourcesInfoMessages",function(){return Object.keys(r.state.infoMessageQueue).length<=0?null:Object.keys(r.state.infoMessageQueue).map(function(e){return React.createElement(U.Notice,{status:"info",key:e,isDismissible:!1},r.state.infoMessageQueue[e])})}),At(Rt(r),"renderDynamicSourceSelectControls",function(){if(r.props.dynamicSourcesEligibleAttribute.condition)return[r.renderDynamicPostProviderSelect(),r.renderDynamicSourceSearchPost(),r.renderDynamicSourceSelect(),r.renderDynamicSourceFieldsSelect()]}),At(Rt(r),"renderDynamicSourceToggleControl",function(){var e=r.props.dynamicSourcesEligibleAttribute;return e.toggleHide||!1?null:React.createElement(U.ToggleControl,{label:e.label,checked:e.condition,onChange:e.toggleChangedCallback})}),At(Rt(r),"renderDynamicSourceControls",function(){var e=r.props,t=e.clientId,n=e.dynamicSourcesEligibleAttribute,o=n.attributeKey?"-"+n.attributeKey:"";if(n)return React.createElement("div",{className:t+o},r.renderDynamicSourceToggleControl(),r.renderDynamicSourceSelectControls(),r.renderDynamicSourcesInfoMessages())}),r.DEFAULT_POST_PROVIDER=It.postProviders[0].value;var s=e.dynamicSourcesEligibleAttribute,u=s.postProvider,l=s.source,p=s.field,d=s.customPost,f=Boolean(u&&l&&p);return r.state={infoMessageQueue:{},postProvider:u,customPost:d,source:l,field:p,fieldWasSelected:f},Object(o.addAction)("tb.dynamicSources.actions.dynamicSourceComponentDidMount","toolset-blocks",function(e){if(e===r.props.clientId){var t=r.props.dynamicSourcesEligibleAttribute,n=Object(a.find)(r.ungroupedSources,{value:t.sourceObject})||null;if(n){Object(o.doAction)("tb.dynamicSources.actions.source.changed",n);var c=n.fields.length>0?Object(a.find)(n.fields,{value:t.fieldObject}):null;c&&Object(o.doAction)("tb.dynamicSources.actions.field.changed",c)}}}),r}var r,n,i,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ft(e,t)}(t,x["Component"]),r=t,(n=[{key:"componentDidMount",value:function(){var e=this;Object(o.addAction)("tb.dynamicSources.actions.field.changed","toolset-blocks",function(t){var r=e.state.infoMessageQueue;t&&"rfg"===t.type?r.rfg=React.createElement(x.Fragment,null,React.createElement("p",{dangerouslySetInnerHTML:{__html:Object(c.sprintf)(Object(c.__)("%1$s is a Repeating Field Group. If you want to display its fields here, put another View block into this Loop item and choose %1$s in the Content Selection step of the View wizard.","wpv-views"),"<strong>".concat(t.label,"</strong>"))}})):delete r.rfg,e.setState({infoMessageQueue:r})}),Object(o.doAction)("tb.dynamicSources.actions.dynamicSourceComponentDidMount",this.props.clientId),this.state.customPost&&!It.dynamicSources[this.state.customPost.value]&&this.loadSourceFromCustomPost(this.state.customPost)}},{key:"loadSourceFromCustomPost",value:(s=jt(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(t);case 2:r=t.value,this.setState({postProvider:r});case 4:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"isCustomPostProvider",value:function(e){return e.match(/^custom_post_type\|[^\|]+\|\d+$/)||"__custom_post"===e}},{key:"fetchDynamicContent",value:function(e,t,r,n){if(!this.state.customPost)return b(e,t,r,n);var o=this.isCustomPostProvider(e),c=wt((o?this.state.customPost.value:"").split("|"),2)[1],i=o?c:t,s=o?this.state.customPost.value:e;return b(s,i,r,n)}},{key:"render",value:function(){return this.renderDynamicSourceControls()}}])&&kt(r.prototype,n),i&&kt(r,i),t}(),xt=Object(V.compose)([Object(n.withSelect)(function(e){var t=e("core/editor"),r=t.getCurrentPostId,n=t.getCurrentPostType,o=e(It.dynamicSourcesStore).getPreviewPost;return{post:r(),postType:n(),previewPost:o()}}),Object(n.withDispatch)(function(e){var t=e("core/notices").createErrorNotice,r=e(It.dynamicSourcesStore);return{createErrorNotice:t,setLoading:r.setLoading,setPreviewPost:r.setPreviewPost}})])(Tt);function Ut(){return(Ut=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Vt(e,t,r,n,o,c,i){try{var s=e[c](i),a=s.value}catch(e){return void r(e)}s.done?t(a):Promise.resolve(a).then(n,o)}function Lt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Nt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Lt(r,!0).forEach(function(t){Bt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lt(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Bt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mt(e){return(Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Kt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function qt(e){return(qt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Gt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wt(e,t){return(Wt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qt={isActive:!1,provider:null,source:null,customPost:null,field:null},Ht=Object(V.createHigherOrderComponent)(function(e){return function(t){function r(){var e,t,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),t=this,(e=!(o=qt(r).apply(this,arguments))||"object"!==Mt(o)&&"function"!=typeof o?Gt(t):o).dynamicFieldsRegister=e.dynamicFieldsRegister.bind(Gt(e)),e.dynamicFieldControlRender=e.dynamicFieldControlRender.bind(Gt(e)),e.dynamicFieldGet=e.dynamicFieldGet.bind(Gt(e)),e.dynamicFieldReset=e.dynamicFieldReset.bind(Gt(e)),e.dynamicFieldNoDataRender=e.dynamicFieldNoDataRender.bind(Gt(e)),e.requestUpdateContent=e.requestUpdateContent.bind(Gt(e)),e.doUpdateContent=e.doUpdateContent.bind(Gt(e)),e.requestFieldToggle=e.requestFieldToggle.bind(Gt(e)),e.requestFieldAttributeUpdate=e.requestFieldAttributeUpdate.bind(Gt(e)),e.doFieldsAttributeUpdate=e.doFieldsAttributeUpdate.bind(Gt(e)),e.currentPostId=Object(n.select)("core/editor").getCurrentPostId(),e.updateContentDebounce=null,e.updateFieldsAttributesDebounce=null,e.attributesUpdateRequired=!1,e}var i,s,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wt(e,t)}(r,x["Component"]),i=r,(s=[{key:"componentDidMount",value:function(){this.requestUpdateContent(),Object(o.addAction)("tb.dynamicSources.actions.cache.updated","toolset-blocks",this.requestUpdateContent)}},{key:"dynamicFieldsRegister",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dynamic";"object"===Mt(e)?this.fields?Object.keys(this.fields).toString()!==Object.keys(e).toString()&&this.throwError("dynamicFieldsRegister() is called twice. Register all fields with one call."):(this.dynamicRootAttributeKey=r,this.fields={},Object.keys(e).forEach(function(n){e[n].attributeKey=e[n].attributeKey||n,t.fields[n]=Nt({},Qt,{},t.props.attributes[r]&&t.props.attributes[r][n]?t.props.attributes[r][n]:{},{},e[n])})):this.throwError("dynamicFieldsRegister() first parameter must be an object.")}},{key:"dynamicFieldControlRender",value:function(e){if(this.fieldExists(e))return React.createElement(xt,{clientId:this.props.clientId,dynamicSourcesEligibleAttribute:this.getFieldControlSetup(this.fields[e])})}},{key:"dynamicFieldGet",value:function(e){return this.fieldExists(e)?this.fields[e]:Qt}},{key:"dynamicFieldReset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.fieldExists(e)&&this.requestFieldAttributeUpdate(this.fields[e],null,t)}},{key:"dynamicFieldNoDataRender",value:function(e){if(this.fieldExists(e)){var t=this.fields[e];return!this.props.attributes[t.attributeKey]&&t.isActive&&t.source?React.createElement("span",{style:{color:"#ccc"}},Object(c.__)("This dynamic source returned no content.","wpv-views")):null}}},{key:"fieldExists",value:function(e){return"string"!=typeof e?(this.throwError("First parameter must be a string"),!1):!(!this.fields||!this.fields[e])||(this.throwError('The requested field "'.concat(e,'" is not registered.')),!1)}},{key:"getFieldControlSetup",value:function(e){var t=this,r=e.label||Object(c.__)("Dynamic Source","wpv-views");return{attributeKey:e.attributeKey,label:r,condition:e.condition||e.isActive,postProvider:e.provider,source:e.source,field:e.field,customPost:e.customPost,toggleHide:e.toggleHide||!1,toggleChangedCallback:function(){t.requestFieldToggle(e)},fieldSelectedCallback:function(r){t.requestFieldAttributeUpdate(e,r)},category:e.category||"text",bannedCategories:e.bannedCategories||[]}}},{key:"updateFieldContent",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(t&&e.customContentCallback){if("function"==typeof e.customContentCallback)return e.customContentCallback(t,this.props.attributes,n),!1;this.throwError("customContentCallback must be a function.")}else{var o=t&&t.sourceContent?me(t.sourceContent):"";if(e.parse)switch(e.parse){case"int":o=parseInt(o);break;case"float":o=parseFloat(o)}if(r)return Bt({},e.attributeKey,o);this.props.setAttributes(Bt({},e.attributeKey,o))}}},{key:"requestFieldToggle",value:function(e){this.fields[e.attributeKey].isActive=!this.fields[e.attributeKey].isActive,this.attributesUpdateRequired=!0,this.doFieldsAttributeUpdate(),this.fields[e.attributeKey].isActive&&this.requestUpdateContent()}},{key:"requestFieldAttributeUpdate",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===r&&e.toggleHide&&(this.fields[e.attributeKey].isActive=!0),null!==r&&(this.fields[e.attributeKey].isActive=!!r),null===t?(this.fields[e.attributeKey].customPost=null,this.fields[e.attributeKey].field=null,this.fields[e.attributeKey].provider=null,this.fields[e.attributeKey].source=null):(this.fields[e.attributeKey].customPost=t.customPost,this.fields[e.attributeKey].field=t.field,this.fields[e.attributeKey].provider=t.postProvider,this.fields[e.attributeKey].source=t.source),this.attributesUpdateRequired=!0,this.doFieldsAttributeUpdate(),this.requestUpdateContent()}},{key:"doFieldsAttributeUpdate",value:function(){var e=this,t={};this.attributesUpdateRequired&&(this.attributesUpdateRequired=!1,Object.keys(this.fields).forEach(function(r){var n=function(e,t){if(void 0===t)return{};var r=Object(a.reduce)(e,function(e,r,n){return Object(a.isEqual)(r,t[n])?e:e.concat(n)},[]),n={};return r.forEach(function(e){n[e]=t[e]}),n}(Qt,e.fields[r]);Object.keys(n).length>0&&(t[r]=n)}),this.props.setAttributes(Bt({},this.dynamicRootAttributeKey,t)))}},{key:"requestUpdateContent",value:function(){clearTimeout(this.updateContentDebounce),this.updateContentDebounce=setTimeout(this.doUpdateContent,500)}},{key:"doUpdateContent",value:function(){var e=this,t=this.currentPostId,r=this.props,c=r.setAttributes,i=r.clientId,s=window.toolsetDynamicSourcesScriptData,a=Object(o.applyFilters)("tb.dynamicSources.filters.adjustPreviewPostID",Object(n.select)(s.dynamicSourcesStore).getPreviewPost(),i)||t;Object.keys(this.fields).map(function(){var t,r=(t=regeneratorRuntime.mark(function t(r){var n,o,i,s,u,l,p,d,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.fields[r],o=n.isActive,i=n.source,s=n.field,u=n.provider,l=n.customPost,o){t.next=3;break}return t.abrupt("return");case 3:return p=l?l.value:u,t.next=6,b(p,a,i,s||null);case 6:d=t.sent,!1!==(f=e.updateFieldContent(e.fields[r],d,!0,i))&&c(f);case 9:case"end":return t.stop()}},t)}),function(){var e=this,r=arguments;return new Promise(function(n,o){var c=t.apply(e,r);function i(e){Vt(c,n,o,i,s,"next",e)}function s(e){Vt(c,n,o,i,s,"throw",e)}i(void 0)})});return function(e){return r.apply(this,arguments)}}())}},{key:"throwError",value:function(e){console.error("[withToolsetDynamicField] ".concat(e))}},{key:"render",value:function(){return React.createElement(x.Fragment,null,React.createElement(je,this.props),React.createElement(e,Ut({},this.props,{dynamicFieldsRegister:this.dynamicFieldsRegister,dynamicFieldControlRender:this.dynamicFieldControlRender,dynamicFieldNoDataRender:this.dynamicFieldNoDataRender,dynamicFieldGet:this.dynamicFieldGet,dynamicFieldReset:this.dynamicFieldReset})))}}])&&Kt(i.prototype,s),u&&Kt(i,u),r}()},"withToolsetDynamicField");function $t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Yt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Jt(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"current",i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{};if(e&&t){var a=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$t(r,!0).forEach(function(t){Yt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$t(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({provider:n,post:c,source:t},s),u="[tb-dynamic";return Object.keys(a).forEach(function(e){u+=" ".concat(e,"='").concat(a[e],"'")}),r&&(u+=" field='".concat(r,"'")),i&&(u+=" force-string='".concat(i,"' ")),u+="]"}return o}var zt=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||!e.isActive||!e.source)return t;var n=r.post||"current",o=r.repeatableFieldShowOnly||!1,c=r.extraAttributes||{},i=e.customPost?e.customPost.value:e.provider;return Jt(e.isActive,e.source,e.field,i,t,n,o,c)};r.d(t,"assureString",function(){return me}),r.d(t,"withPostPreview",function(){return Fe}),r.d(t,"fetchDynamicContent",function(){return b}),r.d(t,"fetchCache",function(){return y}),r.d(t,"searchPost",function(){return m}),r.d(t,"loadSourceFromCustomPost",function(){return v}),r.d(t,"SaveWrapper",function(){return Le}),r.d(t,"EditWrapper",function(){return Ze}),r.d(t,"EditOverlay",function(){return ct}),r.d(t,"DynamicSource",function(){return Ot}),r.d(t,"DynamicSourceUnified",function(){return xt}),r.d(t,"withToolsetDynamicField",function(){return Ht}),r.d(t,"getShortcodeOrStatic",function(){return zt});var Xt=window.WPViews;S(),T(),Xt&&(new ne,new ye)}]);